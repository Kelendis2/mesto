(()=>{"use strict";const e=document.querySelector(".form_type_profile"),t=document.querySelector(".form_type_content"),s=document.querySelector(".card-template"),n=document.querySelector(".profile__edit-button"),o=document.querySelector(".profile__add-button"),r={formSelector:".form",inputSelector:".form__input",inputSectionSelector:".form__field",inputInvalidClass:"form__input_invalid",submitButtonSelector:".form__button-save",inactiveButtonClass:"form__button-save_inactive",errorSelector:".form__input-error",errorClass:"form__input-error_active"};class i{constructor(e){this._popup=document.querySelector(e),this._buttonClose=this._popup.querySelector(".popup__close-button")}open(){this._popup.classList.add("popup_opened"),document.addEventListener("keydown",this._handleEscClose)}close(){this._popup.classList.remove("popup_opened"),document.removeEventListener("keydown",this._handleEscClose)}_handleEscClose=e=>{"Escape"===e.key&&this.close()};_handleCloseOverlay(e){e.target.classList.contains("popup_opened")&&this.close()}setEventListeners(){this._buttonClose.addEventListener("click",(()=>{this.close()})),this._popup.addEventListener("mousedown",this._handleCloseOverlay.bind(this))}}class l extends i{constructor(e,t){let{submitCallback:s}=t;super(e),this._submitCallback=s,this._form=this._popup.querySelector(".form"),this._inputs=Array.from(this._form.querySelectorAll(".form__input"))}_getInputValues(){return this._formValues={},this._inputs.forEach((e=>{this._formValues[e.name]=e.value})),this._formValues}setInputValues(e){this._inputs.forEach((t=>{t.value=e[t.name]}))}setEventListeners(){super.setEventListeners(),this._form.addEventListener("submit",(e=>{e.preventDefault(),this._submitCallback(this._getInputValues())}))}close(){super.close(),this._form.reset()}}class a{constructor(e,t,s){this._link=e.link,this._name=e.name,this._alt=e.name,this._handleCardClick=s,this._templateSelector=t}_getTemplate(){return this._templateSelector.content.cloneNode(!0).children[0]}generateCard(){return this.element=this._getTemplate(),this._cardImage=this.element.querySelector(".element__photo"),this._cardImage.src=this._link,this._cardImage.alt=this._name,this._title=this.element.querySelector(".element__title"),this._title.textContent=this._name,this._buttonTrash=this.element.querySelector(".element__trash"),this._likeButton=this.element.querySelector(".element__like"),this._setEventListners(this.element),this.element}_handleButtonLike(){this._likeButton.classList.toggle("element__like_activ")}_handleButtonTrash(){this.element.remove()}_handleOpenPopup(){this._handleCardClick(this._name,this._link)}_setEventListners(){this._buttonTrash.addEventListener("click",(()=>{this._handleButtonTrash()})),this._likeButton.addEventListener("click",(()=>{this._handleButtonLike()})),this._cardImage.addEventListener("click",(()=>{this._handleOpenPopup(this.element)}))}}const _=class{constructor(e,t){this._form=t,this._options=e,this._submitElement=this._form.querySelector(this._options.submitButtonSelector),this._inputs=Array.from(this._form.querySelectorAll(this._options.inputSelector))}_hideError(e){e.classList.remove(this._options.inputInvalidClass),this._getErrorElement(e).classList.remove(this._options.errorClass),this._getErrorElement(e).textContent=""}_showError(e){e.classList.add(this._options.inputInvalidClass),this._getErrorElement(e).classList.add(this._options.errorClass),this._getErrorElement(e).textContent=e.validationMessage}_enableButton(){this._submitElement.removeAttribute("disabled"),this._submitElement.classList.remove(this._options.inactiveButtonClass)}_disabledButton(){this._submitElement.disabled="true",this._submitElement.classList.add(this._options.inactiveButtonClass)}_getErrorElement(e){return this._form.querySelector(`#${e.id}-error`)}_toggleButtonState(){this._inputs.every((e=>e.validity.valid))?this._enableButton():this._disabledButton()}_toggleErrorState(e){e.validity.valid?this._hideError(e):this._showError(e)}cleanValidation(){this._toggleButtonState(),this._inputs.forEach((e=>{this._hideError(e)}))}_setEventListeners(e){this._toggleButtonState(),this._inputs.forEach(((e,t)=>{e.addEventListener("input",(()=>{this._toggleErrorState(e),this._toggleButtonState()}))}))}enableValidation(){const e=this._form;this._setEventListeners(e)}},p=e=>new a(e,s,h).generateCard(),c=new class{constructor(e){let{items:t,renderer:s}=e;this._items=t,this._renderer=s,this._container=document.querySelector(".element")}addItem(e){this._container.append(e)}addItemPrepend(e){this._container.prepend(e)}renderItem(){this._items.forEach((e=>{this._renderer(e)}))}}({items:[{name:"Архыз",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/arkhyz.jpg"},{name:"Челябинская область",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/chelyabinsk-oblast.jpg"},{name:"Иваново",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/ivanovo.jpg"},{name:"Камчатка",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/kamchatka.jpg"},{name:"Холмогорский район",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/kholmogorsky-rayon.jpg"},{name:"Байкал",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/baikal.jpg"}],renderer:e=>{c.addItem(p(e))}});c.renderItem();const u=new class extends i{constructor(e){super(e),this._popupImg=this._popup.querySelector(".popup__photo-zoom"),this._popupTitle=this._popup.querySelector(".popup__copyright")}open(e,t){super.open(),this._popupTitle.textContent=e,this._popupImg.alt=e,this._popupImg.src=t}close(){super.close()}}(".popup_type_photo");function h(e,t){u.open(e,t)}u.setEventListeners();const d=new _(r,t);d.enableValidation(),new _(r,e).enableValidation();const m=new class{constructor(e){let{profileNameSelector:t,profileInfoSelector:s}=e;this._userName=document.querySelector(t),this._userInfo=document.querySelector(s)}getUserInfo(){return{name:this._userName.textContent,about:this._userInfo.textContent}}setUserInfo(e){let{name:t,about:s}=e;this._userName.textContent=t,this._userInfo.textContent=s}}({profileNameSelector:".profile__info-title",profileInfoSelector:".profile__info-subtitle"}),f=new l(".popup_type_profile",{submitCallback:e=>{m.setUserInfo(e),f.close()}});f.setEventListeners(),n.addEventListener("click",(()=>{f.open(),f.setInputValues(m.getUserInfo())}));const v=new l(".popup_type_content",{submitCallback:e=>{c.addItemPrepend(p({name:e.name,link:e.link})),v.close()}});v.setEventListeners(),o.addEventListener("click",(()=>{v.open(),d.cleanValidation()}))})();